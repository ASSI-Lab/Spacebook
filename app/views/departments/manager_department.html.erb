<!DOCTYPE html>
<html lang="it">
<head>

	<title> Il mio dipartimento - Spacebook </title>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap.min.css">

    <script>
        $(document).ready(function () {
            $('#datatableSpazi').DataTable({
                dom: '<"row"<"col"t>><"row mt-1"<"col"p>>',
                scrollX: true,
                filter: 'false',
                pagingType: "simple_numbers",
                pageLength: 10,
                language: {
                    zeroRecords: 'Nessuno spazio creato',
                    paginate: {
                        first:    '<i class="bi bi-caret-left-fill"></i>',
                        previous: '<i class="bi bi-arrow-left-circle"></i>',
                        next:     '<i class="bi bi-arrow-right-circle"></i>',
                        last:     '<i class="bi bi-caret-right-fill"></i>'
                    }
                }
            });
		});
	</script>
	<script>
        $(document).ready(function () {
            $('#datatablePrenotazioni').DataTable({
                dom: '<"row"<"col"t>><"row mt-1"<"col"p>>',
                scrollX: true,
                filter: 'false',
                pagingType: "simple_numbers",
                pageLength: 10,
                language: {
                    zeroRecords: 'Nessuna prenotazione',
                    paginate: {
                        first:    '<i class="bi bi-caret-left-fill"></i>',
                        previous: '<i class="bi bi-arrow-left-circle"></i>',
                        next:     '<i class="bi bi-arrow-right-circle"></i>',
                        last:     '<i class="bi bi-caret-right-fill"></i>'
                    }
                }
            });
        });
    </script>

</head>

<body>
	<div class="row">
		<!-- Introduzione -->
		<div class="col">
			<div class="card">
				<div class="card-body">
					<h2 class="font-weight-light mt-3 mb-4"> Ecco il tuo dipartimento </h2>
					<p class="card-text">
						In questa pagina puoi gestirlo, modificare gli spazi, le piante caricate e sbirciare tutte le prenotazioni ihihih
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="row mt-4">
		<!-- Card del dipartimento -->
		<div class="col-xl-7">
			<div class="card">
				<div class="card-header"> 
					<table width="100%">
						<tr>
							<td width="76%">
								<h3 class="font-weight-light my-3"> <%= (@department).name %> </h3>
							</td>
							<td width="12%">
								<!-- Tasto per l'update -->
								<button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#tempSpID<%= @department.id %>"> Aggiorna </button>
								<%= render 'modal_dep_edit', mydep: @department %>
							</td>
							<td width="12%">
								<!-- Tasto per l'eliminazione -->
								<%= button_to 'Elimina', @department, method: :delete, data: { confirm: 'Sicuro di voler rimuovere il dipartimento?' }, :class=>"btn btn-outline-info" %>
							</td>
						</tr>
					</table>
				</div>
				<div class="card-body">
					<!-- Descrizione + dati + orari -->
					<table width="100%">
						<tr>
							<td width="55%" class="ms-0 ps-0">
								<!-- Descrizione truncate tramite modal -->
								<label class="label h5 pt-2 pb-0">
									<label class="h5 pt-2 pb-0"> Descrizione: </label>
									<!-- Icona interattiva per visualizzare il modal della descrizione completa -->
									<i class="colorLink bi bi-card-text" data-bs-toggle="modal" data-bs-target="#dep<%= @department.id %>DescModal"> continua a leggere </i>
									<!-- Truncate -->
									<label class="text-truncate" style="width: 450px"> <%= (@department).description %> </label>
									<!-- Modal descrizione -->
									<%= render 'modal_dep_desc', department: @department %>
								</label>

								<label class="label h5 pt-0 pb-0"> Posizione: </label> <%= (@department).via %>, <%= (@department).civico %>, <%= (@department).cap %>, <%= (@department).citta %>, <%= (@department).provincia %><br>
								<label class="label h5 pt-2 pb-0"> Numero piani: </label> <%= (@department).floors %><br>
								<label class="label h5 pt-2 pb-0"> Numero spazi: </label> <%= (@department).number_of_spaces %>
							</td>
							<td width="45%" class="px-3 pt-2"> <!-- Orari -->
								<label class="label h5 pt-2 pb-0"> Orari <i class="bi bi-clock"></i> </label> 
								<!-- Raccoglie tutti gli orari del dipartimento -->
								<% @week_days.where(department_id: (@department).id).each do |wd| %>
									<div class="row">
										<div class="col-sm-5">
											<h6><%= wd.day %></h6>
										</div>
										<div class="col-sm-7">
											<% if wd.state == "Aperto" %>
												<%= wd.apertura.strftime('%H:%M') %>-<%= wd.chiusura.strftime('%H:%M') %>
											<% else %>
												<%= wd.state %>
											<% end %>
										</div>
									</div>
								<% end %>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		<!-- Carousel piante -->
		<div class="col-xl-5">
			<% if @department.dep_map!=nil%>
				<div class="card">
					<div class="card-header text-center">
						<h3 class="font-weight-light my-3"> Pianta interattiva del dipartimento </h3>
						<div class="small text-muted"> Clicca nell'area del designer per modificare il modello per il tuo dipartimento. Ricorda di modificare i dati del tuo dipartimento di conseguenza! </div>
					</div>
					<div class="card-body">
						<div id="chartDesigner"></div>
						<script src="https://cdn-eu.seatsio.net/chart.js"></script>

						<script>
							new seatsio.SeatingChartDesigner({
								divId: 'chartDesigner',
								secretKey: '<%= ENV['SEATS_IO_SECRET'] %>',
								chartKey: '<%= @department.dep_map %>'
							}).render();
						</script> 
					</div>
				</div>
			<% end %>
		</div>
	</div>

	<div class="row mt-4">
		<!-- SPAZI DEL DIPARTIMENTO -->
		<div class="col-xl-7">
			<div class="card">
				<div class="card-header text-center">
					<h3 class="font-weight-light my-3"> Spazi del dipartimento </h3>
				</div>
				<div class="card-body">
					<table id="datatableSpazi" class="display table-responsive table-striped table-hover" width="100%"> 
						<thead>
							<tr class="h6">
								<th width="14%">Tipologia</th>
								<th width="14%">Nome</th>
								<th width="14%">Piano</th>
								<th width="14%">Posti</th>
								<th width="14%">Descrizione</th>
								<th width="14%">Rimuovi</th>
							</tr>
						</thead>
						<tbody>
							<% @spaces.each do |space| %>
								<tr>
									<td><%= space.typology %></td>
									<td><%= space.name %></td>
									<td style="text-align:center"><%= space.floor %></td>
									<td style="text-align:center"><%= space.number_of_seats %></td>
									<td>
										<!-- Icona interattiva per la descrizione -->
										<button style="width:100%" class="btn btn-sm btn-outline-info bi bi-card-text" data-bs-toggle="modal" data-bs-target="#depID<%= space.id %>"></button>
										<!-- Modal della descrizione -->
										<%= render 'modal_sp_desc', space: space %>
									</td>
									<td>
										<!-- Tasto per la rimozioe dello spazio inserito -->
										<%= link_to '', space, method: :delete, data: { confirm: 'Sicuro?' }, :class => "btn btn-sm btn-outline-info bi bi-trash", :style=>"width:100%"%>
									</td>
								</tr>
							<% end %>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<!-- Grafici -->
		<div class="col-xl-5">
			<div class="card">
				<div class="card-header text-center">
					<h3 class="font-weight-light my-3"> Area Chart Example </h3>
				</div>
				<div class="card-body">
					<canvas id="myAreaChart" width="100%" height="40"></canvas>
				</div>
			</div>
		</div>
	</div>
	
	<!-- PRENOTAZIONI DEL DIPARTIMENTO -->
	<div class="row mt-4">
		<div class="col">
			<div class="card">
				<div class="card-header text-center">
					<h3 class="font-weight-light my-3"> Prenotazioni </h3>
				</div>
				<div class="card-body">
					<table id="datatablePrenotazioni" class="display table-responsive table-striped table-hover" width="100%">
						<thead>
							<tr>
								<th> Utente </th>
								<th> Dipartimento </th>
								<th> Tipologia </th>
								<th> Spazio </th>
								<th> Piano </th>
								<th> Posto </th>
								<th> Stato </th>
								<th> Opzioni </th>
							</tr>
						</thead>
						<tbody>
							<% @reservations.each do |reservation| %>
								<tr>
									<td><%= reservation.email %></td>
									<td><%= reservation.dep_name %></td>
									<td><%= reservation.typology %></td>
									<td><%= reservation.space_name %></td>
									<td><%= reservation.floor %></td>
									<td><%= reservation.seat_num %></td>
									<td><%= reservation.state %></td>
									<td><%= button_to 'Destroy', reservation, method: :delete, data: { confirm: 'Are you sure?' }, :class => "btnDestroy" %></td>
								</tr>
							<% end %>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</body>
</html>